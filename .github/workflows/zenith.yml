# Do not edit this file directly. It is generated by https://deno.land/x/fluent_github_actions

name: Zenith Example
on:
  push:
    branches:
      - main

jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Dagger Zenith
        run: |
          curl -L https://dl.dagger.io/dagger/install.sh | DAGGER_VERSION=0.9.11 sh
          sudo mv bin/dagger /usr/local/bin
          dagger version
      - name: Run Dagger Pipelines
        run: |
          dagger functions
          dagger call import-api-specs --src . \
          --specification-files $SPECIFICATION_FILES \
          --microcks-url $MICROCKS_URL \
          --keycloak-client-id $KEYCLOAK_CLIENT_ID \
          --keycloak-client-secret KEYCLOAK_CLIENT_SECRET
          dagger call run-tests --api-name-and-version "$API_NAME_AND_VERSION" \
          --test-endpoint $TEST_ENDPOINT \
          --runner $RUNNER \
          --microcks-url $MICROCKS_URL \
          --keycloak-client-id $KEYCLOAK_CLIENT_ID \
          --keycloak-client-secret KEYCLOAK_CLIENT_SECRET

        working-directory: example
        env:
          SPECIFICATION_FILES: /app/samples/APIPastry-openapi.yaml
          MICROCKS_URL: http://microcks:8080/api
          KEYCLOAK_CLIENT_ID: microcks-serviceaccount
          KEYCLOAK_CLIENT_SECRET: ab54d329-e435-41ae-a900-ec6b3fe15c54
          API_NAME_AND_VERSION: "API Pastry - 2.0:2.0.0"
          TEST_ENDPOINT: "http://localhost:8080/rest/API+Pastry+-+2.0/2.0.0"
          RUNNER: "HTTP"
          WAIT_FOR: "3sec"
